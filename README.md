# 🐾 AI桌宠 (AI Desk Pet)

一个基于 PyQt5 和 DeepSeek API 开发的智能桌面宠物，具有情感系统、长期记忆、视觉识别和整点报时等功能。

## ✨ 功能特性

### 🤖 AI 对话
- 接入 DeepSeek API，支持自然流畅的对话
- 基于 SiliconFlow 视觉 API 的屏幕识别功能（"看看屏幕"）
- 支持流式/非流式响应
- 自动维护对话上下文（短期记忆）

### 💝 好感度系统
- 8 级好感度体系（从"敌视"到"榜样"）
- AI 自动判断对话中的情感变化（-3 到 +3 分）
- 不同好感度等级影响 AI 的回复语气和行为
- 低好感度时桌宠会显示不开心表情

### 🧠 记忆系统
- **短期记忆**：自动保留最近 20 条对话
- **长期记忆**：AI 自动总结对话要点，压缩存储（5-20 条核心记忆）
- 记忆会影响 AI 的回复内容和情感判断

### 🎨 视觉交互
- 透明悬浮窗设计，支持鼠标拖拽移动
- 角色动画系统（眨眼、说话口型变化）
- 双状态表情（正常/不开心）
- 对话气泡逐字显示效果

### ⏰ 智能提醒
- 整点报时功能（提前 30 秒准备，整点播报）
- 根据时间段（早/午/晚）调整问候语
- 结合当前好感度和记忆生成个性化提醒

### ⚙️ 系统功能
- 系统托盘图标（支持后台运行）
- 窗口置顶/取消置顶切换
- 角色缩放（25%-200%）
- 完整的设置界面（用户信息、角色设定、API 配置）

## 🚀 快速开始

### 环境要求
- Python 3.8+
- PyQt5
- requests

### 安装依赖
```bash
pip install PyQt5 requests
```

### 运行项目
```bash
python main.py
```

首次启动会自动创建必要的配置文件和目录。

## 📁 项目结构

```
.
├── main.py                 # 程序入口
├── main_window.py          # 主窗口逻辑
├── config.py               # 全局配置
├── begin.py                # 初始化检查（创建默认配置）
│
├── api_client.py           # API 通信（DeepSeek/SiliconFlow）
├── talk.py                 # 对话管理器（气泡显示、打字效果）
├── animation_manager.py    # 角色动画管理
│
├── heart.py                # 好感度系统
├── memory_manager.py       # 长期记忆管理
├── history_manager.py      # 对话历史管理
├── history_dialog.py       # 历史记录对话框
│
├── setting.py              # 设置界面
├── loader.py               # 配置加载工具
├── look.py                 # 屏幕截图功能
├── time1.py                # 整点报时器
├── icon.py                 # 系统托盘图标
│
├── txt/                    # 配置目录（自动生成）
│   ├── user_info.json      # 用户信息
│   ├── character.json      # 角色设定+好感度配置
│   ├── api.json            # API 密钥和参数
│   └── setting.json        # 系统设置
│
├── log/                    # 日志目录（自动生成）
│   ├── talk_log.json       # 对话历史
│   └── long.json           # 长期记忆+好感度分数
│
└── image/                  # 图片资源目录
    ├── normal1.png         # 正常表情1（闭嘴）
    ├── normal2.png         # 正常表情2（张嘴）
    ├── normal3.png         # 思考表情
    ├── normal4.png         # 闭眼表情
    ├── unhappy1.png        # 不开心表情1
    ├── unhappy2.png        # 不开心表情2
    ├── unhappy3.png        # 不开心思考
    ├── unhappy4.png        # 不开心闭眼
    └── icon.png            # 托盘图标
```

## ⚙️ 配置说明

### 1. API 配置 (`txt/api.json`)
需要配置两个 API：

**对话 API（必需）**
- 默认使用 DeepSeek
- 支持自定义 API 地址和模型

**视觉 API（识图功能）**
- 默认使用 SiliconFlow
- 用于"看看屏幕"功能

### 2. 角色设定 (`txt/character.json`)
- `content`: 角色基础设定（性格、背景等）
- `favorability`: 8 级好感度定义（可自定义分数范围和描述）

### 3. 用户信息 (`txt/user_info.json`)
- `nickname`: 用户昵称
- `birthday`: 生日
- `oc_name`: 对桌宠的称呼
- `relationship`: 关系设定（朋友/主人等）

### 4. 系统设置 (`txt/setting.json`)
- `scale`: 缩放比例（默认 100%）
- `always_on_top`: 窗口置顶
- `show_tray_icon`: 显示托盘图标

## 🎯 使用指南

### 基础交互
- **左键拖拽**：移动桌宠位置
- **双击角色**："戳一戳"互动（会影响好感度）
- **右键菜单**：访问历史记录、设置、退出

### 对话操作
- 鼠标悬停在桌宠区域会显示输入框
- 鼠标移开 0.5 秒后自动隐藏输入框
- 支持回车快速发送

### 特殊功能
- **"看看屏幕"**：右键菜单中选择，AI 会分析当前屏幕内容并评论
- **历史记录**：查看、删除对话历史，浏览长期记忆，查看当前好感度
- **整点报时**：自动在整点生成个性化提醒（提前 30 秒准备）

## ⚠️ 注意事项

1. **API 密钥**：首次使用需要在设置中配置 API 密钥，否则无法对话
2. **图片资源**：确保 `image/` 目录包含必要的表情图片（normal1-4.png），unhappy 图片可选（没有会使用正常图片）
3. **好感度**：好感度低于 -20 时会自动切换为不开心表情组
4. **内存占用**：长期记忆每积累 20 条会自动压缩为 5-10 条核心记忆
5. **兼容性**：支持 Windows/Linux，macOS 可能需要调整窗口标志

## 📝 自定义建议

### 修改角色性格
在设置界面的"角色设定"中修改，或在 `txt/character.json` 中编辑 `content` 字段。

### 添加新表情
1. 准备 4 张 PNG 图片（顺序：闭嘴、张嘴、思考、闭眼）
2. 命名为 `unhappy1.png` ~ `unhappy4.png` 放入 `image/` 目录
3. 当好感度低于阈值时会自动切换

### 调整好感度敏感度
在 `heart.py` 中修改 `judge_change` 方法的 prompt，或调整 `Config.UNHAPPY_THRESHOLD`（默认 -20）。

---

**提示**：所有配置文件的修改都可以在不重启程序的情况下通过设置界面完成，部分设置（如缩放、置顶）会立即生效。